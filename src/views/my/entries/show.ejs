<%- contentFor('styles') %>
<%- contentFor('scripts') %>
<script>
const id = window.location.href.split('/').reverse()[0]

const generateTitle = ({ isLoading, entry } = {}) => {
  if (isLoading) return `<div class="text-center">Loading...</div>`
  if (!entry) return `<h2 class="text-center font-monospace mb-5">Entry ${id} Not Found! :(</h2>`

  return `<h2 class="text-center font-monospace mb-5">My Entry no.${id}</h2>`
}

const generateActivity = (activity) => {
  const activityStr = activity?.activity.toLowerCase()
  // console.log(activityStr)

  return `
    <img src="/images/activities/${activityStr}.png" alt="activity" width="45" height="auto">
  `
}

const generateEntry = ({ isLoading, entry, errors } = {}) => {
  if (isLoading || !entry) return ''
  const mood = entry?.mood || ''
  const activities = entry?.activities || []

  return `
    <div class="d-flex justify-content-center">
      <div class="border border-secondary rounded p-5 mb-5" style="width: 650px; height: 400px;">
        <div class="d-flex flex-row justify-content-end gap-2">
          <button
            id="delete-entry-btn"
            class="btn btn-dark btn-sm"
            type="button"
          >Delete</button>
          <button
            id="edit-entry-btn"
            class="btn btn-outline-dark btn-sm"
            type="button"
          >Edit</button>
        </div>

        <div class="d-flex flex-row gap-5 my-2">
          <div>
            <img id="moodIcon" src="/images/moods/${mood}.png" alt="emotion" width="80"  height="auto" class="rounded-4">
          </div>
          <div class="d-flex flex-column">
            <h1 class="text-uppercase fw-bold mb-1">${mood}</h1>
            <p>${entry?.createdAt.substring(0, 10)}</p>
            <div class="d-flex flex-row gap-2 my-2">
            ${activities.map(generateActivity).join('')}
            </div>
          </div>
        </div>

        <div class="d-flex flex-row justify-content-center mt-4">
          <h5 class="fst-italic fw-light border rounded p-4 m-2">${entry?.gratitude}</h5>
        </div>
      </div>
    </div>
  `
}

const generatePage = (info) => {
  const $page = $('#pages-my-entries-show')
  const $title = generateTitle(info)
  const $entry = generateEntry(info)

  $page.html('').append($title).append($entry)
}

const getEntry= () => {
  axios({
    method: 'GET',
    url: `/api/my/entries/${id}`
  }).then((resp) => {
    generatePage({ entry: resp.data })
  }).catch((err) => {
    generatePage()
  })
}

const handleEditEntry = (e) => {
  window.location.href = `/my/entries/${id}/edit`
}

const handleDeleteEntry = (e) => {
  $(e.currentTarget).attr('disabled', true)

  axios({
    method: 'DELETE',
    url: `/api/my/entries/${id}`
  }).then((resp) => {
    window.location.href = '/my/entries'
  })
}

$(document).ready(() => {
  generatePage({ isLoading: true })
  getEntry()

  $('#pages-my-entries-show').on('click', '#edit-entry-btn', handleEditEntry)
  $('#pages-my-entries-show').on('click', '#delete-entry-btn', handleDeleteEntry)
})
</script>

<%- contentFor('body') %>
<div id="pages-my-entries-show" class="container"></div>
